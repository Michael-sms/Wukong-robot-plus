{% extends "layout.html" %}
{% autoescape None %}
{% block body %}
<link rel="stylesheet" href="{{static_url('bubble.css')}}" crossorigin="anonymous">
<link rel="stylesheet" href="{{static_url('progressjs.min.css')}}" crossorigin="anonymous">
<link rel="stylesheet" href="{{static_url('default.min.css')}}" crossorigin="anonymous">
<link rel="stylesheet" href="{{static_url('monokai-sublime.css')}}" crossorigin="anonymous">

<style>
  html, body {
    height: 100%;
    overflow: hidden; /* 禁用系统滚动条，使用内部滚动 */
  }

  /* 调整导航栏，增加玻璃感 */
  .navbar-nav {
    list-style-type: none !important;
  }
  .navbar-nav li {
    list-style: none !important;
  }
  
  /* 布局容器：flex布局充满屏幕 */
  .layout-container {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 70px); /* 减去 navbar 高度 */
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    gap: 20px;
  }

  .hero-section {
    flex-shrink: 0; /* 不允许压缩 */
    padding: 20px 0;
    text-align: center;
    position: relative;
    /* 去掉背景色，让全局背景透出来，只保留文字 */
  }
  
  .hero-section h1 {
    font-weight: 800;
    font-size: 2.5rem;
    margin-bottom: 0px;
    letter-spacing: -1px;
    background: linear-gradient(to right, #fff, #94a3b8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .hero-section .lead {
    font-size: 1rem;
    color: var(--text-muted);
    margin-bottom: 5px;
  }
  
  /* 聊天主区域：占据剩余所有空间 */
  .chat-wrapper {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--card-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 24px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: hidden;
    position: relative;
  }

  /* 历史记录：可滚动区域 */
  .history-container {
    flex: 1;
    overflow-y: auto;
    padding: 24px;
    scroll-behavior: smooth;
  }
  
  /* 输入表单：固定在底部 */
  .query-form {
    padding: 15px 24px 24px;
    border-top: 1px solid rgba(255,255,255,0.05);
    background: rgba(15, 23, 42, 0.4);
  }

  .form-control-lg {
    background: rgba(15, 23, 42, 0.6) !important;
    border: 1px solid var(--glass-border) !important;
    color: white !important;
    border-radius: 50px !important; /* 圆角输入框 */
    padding: 1.5rem 1.5rem !important;
    font-size: 1rem !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .form-control-lg:focus {
    background: rgba(15, 23, 42, 0.9) !important;
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2) !important;
  }

  .btn-chat {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    border: none;
    border-radius: 50px; /* 圆形按钮 */
    width: 50px;
    height: 50px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    transition: all 0.3s;
  }

  .btn-chat:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(99, 102, 241, 0.6);
  }

  /* 气泡样式优化 */
  .bubble {
    padding: 12px 18px;
    border-radius: 18px;
    max-width: 85%;
    position: relative;
    line-height: 1.6;
    word-wrap: break-word;
  }
  
  .robot-bubble {
    background: #334155;
    color: #f8fafc;
    border-top-left-radius: 4px; /* 对话框尖角方向调整 */
  }
  
  .user-bubble {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    color: white;
    border-top-right-radius: 4px;
  }

  /* 隐藏滚动条 */
  ::-webkit-scrollbar {
    width: 6px;
  }
  ::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
  }
  ::-webkit-scrollbar-thumb:hover {
    background: rgba(255,255,255,0.2);
  }
  
  /* 更新提示条样式 */
  .update-bar {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      width: 90%;
      max-width: 600px;
      backdrop-filter: blur(10px);
  }
</style>

<div class="layout-container">
  
  <!-- 头部区域 -->
  <div class="hero-section">
      <div class="d-flex align-items-center justify-content-center mb-2">
           <img src="./static/robot.png" width="50" alt="wukong-robot" class="mr-3 floating-anim"/>
           <h1 class="display-4">wukong-robot</h1>
      </div>
      <p class="lead">进化中的中文语音对话机器人</p>
      
      <!-- 可能的通知区域 -->
      {% if notices %}
      <div class="mt-2">
      {% for notice in notices %}
        <div class="badge badge-primary p-2 mx-1" style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); color: #a5b4fc; font-weight: 500;">
          <i class="fas fa-sparkles mr-1"></i> {{ linkify(notice) }}
        </div>
      {% end %}
      </div>
      {% end %}
      
      {% if update_info and 'main' in update_info or 'contrib' in update_info %}
        <div class="alert update-alert alert-dismissible fade show mt-2 d-inline-block text-left" role="alert" style="font-size: 0.9rem; padding: 0.5rem 2rem 0.5rem 1rem;">
          <i class="fas fa-rocket mr-2"></i> 系统有更新可用，<a href="#" class="alert-link" id="check-update" data-toggle="modal" data-target="#updateModal">立即查看</a>
          <button type="button" class="close text-white" data-dismiss="alert" aria-label="Close" style="padding: 0.5rem 0.8rem;">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <!-- Modal Omitted -->
      {% end %}
  </div>

  <!-- 主聊天窗口 -->
  <div class="chat-wrapper">
      <div class="history-container">
        <!-- 初始欢迎语或其他历史 -->
        <div class="history"></div>
      </div>

      <div class="query-form">
          <form class="form-row align-items-center mb-0" action="#">
            <div class="col">
              <input type="text" class="form-control form-control-lg" name="query" id="query" placeholder="{{suggestion}}" required autofocus autocomplete="off">
            </div>
            <div class="col-auto pl-0">
              <button type="submit" class="btn btn-primary btn-chat shadow-lg CHAT">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </form>
      </div>
  </div>

</div>

<!-- 移除赞助商区域或将其移至页脚 -->

<script>
// 简单的自动聚焦
window.onload = function() {
  document.getElementById("query").focus();
}
</script>


<br/>

<ul id="recorder" class="mfb-component--br mfb-zoomin" data-mfb-toggle="hover">
      <li class="mfb-component__wrap">
        <a href="#" id="record" class="mfb-component__button--main">
          <i class="mfb-component__main-icon--resting fa fa-microphone"></i>
          <i class="mfb-component__main-icon--active fa fa-times"></i>
        </a>
        <ul class="mfb-component__list">
          <li>
            <a href="#" id="stop-record" data-mfb-label="停止录制语音指令" class="mfb-component__button--child">
              <i class="mfb-component__child-icon fas fa-stop"></i>
            </a>
          </li>
          <li>
            <a href="#" id="start-record" data-mfb-label="开始录制语音指令" class="mfb-component__button--child ">
              <i class="mfb-component__child-icon fas fa-circle"></i>
            </a>
          </li>
        </ul>
      </li>
    </ul>


<script src="./static/highlight.min.js"></script>
<script src="./static/markdown-it.min.js"></script>
<script src="{{static_url('main.js')}}" crossorigin="anonymous"></script>
<script src="{{static_url('index.js')}}" crossorigin="anonymous"></script>
<script src="./static/recorder.min.js"></script>
<script src="./static/progress.min.js"></script>
{% end %}
