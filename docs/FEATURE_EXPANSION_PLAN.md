# wukong-robot 功能扩展计划（2026-01-30）

## 背景与目标
- 现状：已具备声纹识别、角色语音、18 个插件和全链路监控，但网络依赖与生态深度不足。
- 目标：在 6 个月内扩充高价值功能，降低网络依赖，强化多模态与内容生态，同时保持“声纹+角色语音”差异化。

## 核心原则
- 高价值先行：优先满足智能家居与内容播放等高频需求。
- 可降级设计：所有云服务提供本地/备用选项，保证弱网可用。
- 插件化演进：新能力尽量封装为独立插件或可插拔模块。
- 数据与隐私：对话记忆和声纹数据可选加密、可配置保留期。

## 计划项与交付

### P0（1-3 个月）
1) 智能家居控制插件 `SmartHome.py`
   - 集成米家 / HomeAssistant / MQTT，支持灯光、空调等常用指令。
   - 复用 NLU 槽位提取；提供设备发现与状态播报。

2) 在线音乐服务 `OnlineMusic.py`
   - 对接网易云 / QQ 音乐 API；歌曲搜索、播放列表、歌词同步。
   - 提供多源降级（源失效自动切换）。

3) 离线语音能力
   - `robot/ASR.py` 增加 Whisper 本地选项；配置开关 `offline_mode`。
   - `robot/AI.py` 增加本地 LLM（Qwen/Llama）入口，支持无网应答。

4) 多轮对话记忆
   - 改造 `Conversation`/`History`：维护最近 N 轮上下文；支持 ChatGPT conversation_id 或本地 SQLite；
   - 配置：`conversation_memory_enabled`、`history_window=5`、`retention_days`。

### P1（3-6 个月）
5) 知识与工具插件
   - `Wikipedia.py`：维基百科查询；
   - `Calculator.py`：基于 sympy 的科学计算。

6) 开发者工具链
   - `tools/plugin_generator.py`：交互式生成插件模板（包含 SLUG、正则、handle 框架）。

7) 内容生态增强
   - 新闻 / 播客 / 有声书聚合插件；
   - 成语接龙、谜语等轻量游戏插件。

### P2（6-12 个月）
8) 多模态交互
   - 摄像头接入物体识别 / OCR / 人脸识别；视觉问答。

9) 情感化语音
   - 集成 BERT-VITS2 情感标签或 GPT-SoVITS 采样；情感参数暴露为配置。

10) 个性化推荐
   - 基于用户画像和历史对话的音乐/内容推荐；可选数据持久化与清理策略。

## 里程碑与验收
- M1（1 个月）：`SmartHome` 最小可用版 + 在线音乐基础播放 + Whisper 接入。
- M2（2 个月）：多轮对话记忆上线 + 本地 LLM 打通 + 音乐多源降级。
- M3（3 个月）：知识/计算插件发布 + 插件生成器工具。
- M4（6 个月）：多模态基础版 + 情感化语音 Alpha。

## 风险与对策
- 网络/版权限制：音乐与知识 API 提供多源与缓存；失败降级播报。
- 性能瓶颈：Whisper/LLM 需检测硬件，提供模型尺寸选项与懒加载；TTS/ASR 采用流式输出降低延迟。
- 隐私与合规：对话记忆、声纹向量可选加密；配置化保留期；提供一键清理工具。
- 生态复杂度：所有新功能插件化，减少对核心模块的侵入；维护测试样例和回归 checklist。

## 配置与运维建议
- 新增配置示例：`offline_mode`、`conversation_memory_enabled`、`history_window`、`retention_days`、`tts_emotion`。
- 提供示例 `.env`/YAML 片段，标注必填/可选项；更新 docs 中的使用手册链接。
- 监控：在现有延迟监控基础上，为新插件埋点（ASR/TTS/技能耗时、失败率）。
